{"version":3,"file":"index.js","sources":["../src/index.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react'\nimport { LinkedMarkdown } from '@linkedmd/parser'\nimport './styles.css'\n\nconst IPFS_GATEWAY = 'https://cf-ipfs.com/ipfs'\n\nconst fetchAndParse = async (fileURI: string) => {\n  const ipfsURI = fileURI.startsWith('ipfs://')\n    ? `${IPFS_GATEWAY}/${fileURI.split('ipfs://')[1]}`\n    : false\n  const data = await fetch(ipfsURI ? ipfsURI : fileURI)\n  const file = await data.text()\n  const parser = new LinkedMarkdown(file)\n  await parser.parse()\n  return { file, parser }\n}\n\nconst getUrlParams = (search: string) => {\n  let hashes = search.slice(search.indexOf('#') + 1).split('&')\n  return hashes.reduce((params, hash) => {\n    let [key, val] = hash.split('=')\n    return Object.assign(params, { [key]: decodeURIComponent(val) })\n  }, {})\n}\n\ntype FileURICallback = (newFileURI: string) => any\n\ninterface Props {\n  fileURI: string\n  onFileURIChange?: FileURICallback\n}\n\nexport const LinkedMarkdownViewer = ({ fileURI, onFileURIChange }: Props) => {\n  const [fileStack, setFileStack] = useState<string[]>([])\n  const [output, setOutput] = useState('')\n\n  const fetchAndSet = (newFileURI: string) => {\n    fetchAndParse(newFileURI).then(({ parser }: { parser: any }) => {\n      setFileStack(fileStack.concat([newFileURI]))\n      setOutput(parser.toHTML() || '')\n      console.log(newFileURI)\n      onFileURIChange && onFileURIChange(newFileURI)\n    })\n  }\n\n  useEffect(() => {\n    fetchAndSet(fileURI)\n  }, [])\n\n  window.addEventListener('hashchange', () => {\n    const params = getUrlParams(window.location.hash)\n    const newFileURI = params['LinkedMD-URI']\n    newFileURI && fetchAndSet(newFileURI)\n  })\n\n  return (\n    <div className=\"LM-output\" dangerouslySetInnerHTML={{ __html: output }} />\n  )\n}\n\nexport const LinkedMarkdownEditor = ({ fileURI }: Props) => {\n  const [input, setInput] = useState<string>('')\n  const [output, setOutput] = useState('')\n\n  const fetchAndSet = (newFileURI: string) => {\n    fetchAndParse(newFileURI).then(\n      ({ file, parser }: { file: string; parser: any }) => {\n        setInput(file || '')\n        setOutput(parser.toHTML() || '')\n        !!file && localStorage.setItem('saved-input', file)\n      }\n    )\n  }\n\n  useEffect(() => {\n    fetchAndSet(fileURI)\n  }, [fileURI])\n\n  useEffect(() => {\n    const parser = new LinkedMarkdown(input)\n    parser.parse().then(() => {\n      setOutput(parser.toHTML())\n    })\n    input !== '' && localStorage.setItem('saved-input', input)\n  }, [input])\n\n  useEffect(() => {\n    fetchAndSet(fileURI)\n    const savedInput = localStorage.getItem('saved-input')\n    !!savedInput && setInput(savedInput || '')\n  }, [])\n\n  const handleInput = (e: React.SyntheticEvent) => {\n    const target = e.target as typeof e.target & {\n      value: string\n    }\n\n    setInput(target.value)\n  }\n\n  return (\n    <div className=\"LM-split-screen\">\n      <textarea className=\"LM-input\" onChange={handleInput} value={input} />\n      <div className=\"LM-output\" dangerouslySetInnerHTML={{ __html: output }} />\n    </div>\n  )\n}\n"],"names":["IPFS_GATEWAY","fetchAndParse","fileURI","ipfsURI","startsWith","split","fetch","data","text","file","parser","LinkedMarkdown","parse","getUrlParams","search","hashes","slice","indexOf","reduce","params","hash","key","val","Object","assign","decodeURIComponent","LinkedMarkdownViewer","onFileURIChange","useState","fileStack","setFileStack","output","setOutput","fetchAndSet","newFileURI","then","concat","toHTML","console","log","useEffect","window","addEventListener","location","React","className","dangerouslySetInnerHTML","__html","LinkedMarkdownEditor","input","setInput","localStorage","setItem","savedInput","getItem","handleInput","e","target","value","onChange"],"mappings":"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"}