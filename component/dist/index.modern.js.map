{"version":3,"file":"index.modern.js","sources":["../src/index.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react'\nimport { LinkedMarkdown } from '@linkedmd/parser'\nimport './styles.css'\nimport 'process'\n\nconst IPFS_GATEWAY = 'https://cf-ipfs.com/ipfs'\n\nconst fetchAndParse = async (fileURI: string) => {\n  const ipfsURI = fileURI.startsWith('ipfs://')\n    ? `${IPFS_GATEWAY}/${fileURI.split('ipfs://')[1]}`\n    : false\n  const data = await fetch(ipfsURI ? ipfsURI : fileURI)\n  const file = await data.text()\n  const parser = new LinkedMarkdown(file)\n  await parser.parse()\n  return { file, parser }\n}\n\ntype FileURICallback = (newFileURI: string) => any\n\ninterface Props {\n  fileURI: string\n  onFileURIChange?: FileURICallback\n}\n\nexport const LinkedMarkdownViewer = ({ fileURI, onFileURIChange }: Props) => {\n  const [fileStack, setFileStack] = useState<string[]>([])\n  const [output, setOutput] = useState('')\n  const [loading, setLoading] = useState(false)\n\n  const fetchAndSet = async (newFileURI: string, addToStack: boolean) => {\n    setLoading(true)\n    const { parser } = await fetchAndParse(newFileURI)\n    setOutput(parser.toHTML() || '')\n    addToStack && setFileStack((fileStack) => [...fileStack, newFileURI])\n    onFileURIChange && onFileURIChange(newFileURI)\n    setLoading(false)\n  }\n\n  useEffect(() => {\n    fetchAndSet(fileURI, true)\n\n    window.addEventListener(\n      'message',\n      (event) => {\n        if (event.origin !== window.location.origin) return\n\n        try {\n          const newFileURI = JSON.parse(unescape(event.data)).lmURI\n          fetchAndSet(newFileURI, true)\n        } catch (e) {}\n      },\n      false\n    )\n  }, [])\n\n  async function goBack() {\n    await fetchAndSet(fileStack[fileStack.length - 2], false)\n    setFileStack(fileStack.slice(0, -1))\n  }\n\n  return (\n    <div>\n      {fileStack.length > 1 && (\n        <a onClick={goBack} style={{ cursor: 'pointer' }}>\n          ‚Üê Back\n        </a>\n      )}\n      {loading && fileStack.length > 1 && ' | '}\n      {loading && <span>Loading</span>}\n\n      <div className=\"LM-output\" dangerouslySetInnerHTML={{ __html: output }} />\n    </div>\n  )\n}\n\nexport const LinkedMarkdownEditor = ({ fileURI }: Props) => {\n  const [input, setInput] = useState<string>('')\n  const [output, setOutput] = useState('')\n\n  const fetchAndSet = (newFileURI: string) => {\n    fetchAndParse(newFileURI).then(\n      ({ file, parser }: { file: string; parser: any }) => {\n        setInput(file || '')\n        setOutput(parser.toHTML() || '')\n        !!file && localStorage.setItem('saved-input', file)\n      }\n    )\n  }\n\n  useEffect(() => {\n    fetchAndSet(fileURI)\n  }, [fileURI])\n\n  useEffect(() => {\n    const parser = new LinkedMarkdown(input)\n    parser.parse().then(() => {\n      setOutput(parser.toHTML())\n    })\n    input !== '' && localStorage.setItem('saved-input', input)\n  }, [input])\n\n  useEffect(() => {\n    fetchAndSet(fileURI)\n    const savedInput = localStorage.getItem('saved-input')\n    !!savedInput && setInput(savedInput || '')\n  }, [])\n\n  const handleInput = (e: React.SyntheticEvent) => {\n    const target = e.target as typeof e.target & {\n      value: string\n    }\n\n    setInput(target.value)\n  }\n\n  return (\n    <div className=\"LM-split-screen\">\n      <textarea className=\"LM-input\" onChange={handleInput} value={input} />\n      <div className=\"LM-output\" dangerouslySetInnerHTML={{ __html: output }} />\n    </div>\n  )\n}\n"],"names":["IPFS_GATEWAY","fetchAndParse","fileURI","ipfsURI","startsWith","split","fetch","data","text","file","parser","LinkedMarkdown","parse","LinkedMarkdownViewer","goBack","fetchAndSet","fileStack","length","setFileStack","slice","onFileURIChange","useState","output","setOutput","loading","setLoading","newFileURI","addToStack","toHTML","useEffect","window","addEventListener","event","origin","location","JSON","unescape","lmURI","e","React","onClick","style","cursor","className","dangerouslySetInnerHTML","__html","LinkedMarkdownEditor","input","setInput","then","localStorage","setItem","savedInput","getItem","handleInput","target","value","onChange"],"mappings":"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"}