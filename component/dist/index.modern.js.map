{"version":3,"file":"index.modern.js","sources":["../src/index.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react'\nimport { LinkedMarkdown } from '@linkedmd/parser'\nimport './styles.css'\n\nconst IPFS_GATEWAY = 'https://cf-ipfs.com/ipfs'\n\nconst fetchAndParse = async (fileURI: string) => {\n  const ipfsURI = fileURI.startsWith('ipfs://')\n    ? `${IPFS_GATEWAY}/${fileURI.split('ipfs://')[1]}`\n    : false\n  const data = await fetch(ipfsURI ? ipfsURI : fileURI)\n  const file = await data.text()\n  const parser = new LinkedMarkdown(file)\n  await parser.parse()\n  return { file, parser }\n}\n\ntype FileURICallback = (newFileURI: string) => any\n\ninterface Props {\n  fileURI: string\n  onFileURIChange?: FileURICallback\n}\n\nexport const LinkedMarkdownViewer = ({ fileURI, onFileURIChange }: Props) => {\n  const [fileStack, setFileStack] = useState<string[]>([])\n  const [output, setOutput] = useState('')\n  const [loading, setLoading] = useState(false)\n\n  const fetchAndSet = async (newFileURI: string, addToStack: boolean) => {\n    setLoading(true)\n    const { parser } = await fetchAndParse(newFileURI)\n    setOutput(parser.toHTML() || '')\n    addToStack && setFileStack((fileStack) => [...fileStack, newFileURI])\n    onFileURIChange && onFileURIChange(newFileURI)\n    setLoading(false)\n  }\n\n  useEffect(() => {\n    fetchAndSet(fileURI, true)\n\n    window.addEventListener(\n      'message',\n      (event) => {\n        if (event.origin !== window.location.origin) return\n\n        try {\n          const newFileURI = JSON.parse(unescape(event.data)).lmURI\n          console.log(newFileURI)\n          fetchAndSet(newFileURI, true)\n        } catch (e) {}\n      },\n      false\n    )\n  }, [])\n\n  async function goBack() {\n    await fetchAndSet(fileStack[fileStack.length - 2], false)\n    setFileStack(fileStack.slice(0, -1))\n  }\n\n  return (\n    <div>\n      {fileStack.length > 1 && (\n        <a onClick={goBack} style={{ cursor: 'pointer' }}>\n          ‚Üê Back\n        </a>\n      )}\n      {loading && fileStack.length > 1 && ' | '}\n      {loading && <span>Loading</span>}\n\n      <div className=\"LM-output\" dangerouslySetInnerHTML={{ __html: output }} />\n    </div>\n  )\n}\n\nexport const LinkedMarkdownEditor = ({ fileURI }: Props) => {\n  const [input, setInput] = useState<string>('')\n  const [output, setOutput] = useState('')\n\n  const fetchAndSet = (newFileURI: string) => {\n    fetchAndParse(newFileURI).then(\n      ({ file, parser }: { file: string; parser: any }) => {\n        setInput(file || '')\n        setOutput(parser.toHTML() || '')\n        !!file && localStorage.setItem('saved-input', file)\n      }\n    )\n  }\n\n  useEffect(() => {\n    fetchAndSet(fileURI)\n  }, [fileURI])\n\n  useEffect(() => {\n    const parser = new LinkedMarkdown(input)\n    parser.parse().then(() => {\n      setOutput(parser.toHTML())\n    })\n    input !== '' && localStorage.setItem('saved-input', input)\n  }, [input])\n\n  useEffect(() => {\n    fetchAndSet(fileURI)\n    const savedInput = localStorage.getItem('saved-input')\n    !!savedInput && setInput(savedInput || '')\n  }, [])\n\n  const handleInput = (e: React.SyntheticEvent) => {\n    const target = e.target as typeof e.target & {\n      value: string\n    }\n\n    setInput(target.value)\n  }\n\n  return (\n    <div className=\"LM-split-screen\">\n      <textarea className=\"LM-input\" onChange={handleInput} value={input} />\n      <div className=\"LM-output\" dangerouslySetInnerHTML={{ __html: output }} />\n    </div>\n  )\n}\n"],"names":["IPFS_GATEWAY","fetchAndParse","fileURI","ipfsURI","startsWith","split","data","fetch","file","text","parser","LinkedMarkdown","parse","LinkedMarkdownViewer","onFileURIChange","fileStack","setFileStack","useState","output","setOutput","loading","setLoading","fetchAndSet","newFileURI","addToStack","toHTML","useEffect","window","addEventListener","event","origin","location","JSON","unescape","lmURI","console","log","e","goBack","length","slice","React","onClick","style","cursor","className","dangerouslySetInnerHTML","__html","LinkedMarkdownEditor","input","setInput","then","localStorage","setItem","savedInput","getItem","handleInput","target","value","onChange"],"mappings":"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"}