{"version":3,"file":"index.modern.js","sources":["../src/index.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react'\nimport { LinkedMarkdown } from '@linkedmd/parser'\nimport './styles.css'\n\nconst IPFS_GATEWAY = 'https://cf-ipfs.com/ipfs'\n\nconst fetchAndParse = async (fileURI: string) => {\n  const ipfsURI = fileURI.startsWith('ipfs://')\n    ? `${IPFS_GATEWAY}/${fileURI.split('ipfs://')[1]}`\n    : false\n  const data = await fetch(ipfsURI ? ipfsURI : fileURI)\n  const file = await data.text()\n  const parser = new LinkedMarkdown(file)\n  await parser.parse()\n  return { file, parser }\n}\n\ntype FileURICallback = (newFileURI: string) => any\n\ninterface Props {\n  fileURI: string\n  onFileURIChange?: FileURICallback\n}\n\nexport const LinkedMarkdownViewer = ({ fileURI, onFileURIChange }: Props) => {\n  const [fileStack, setFileStack] = useState<string[]>([])\n  const [output, setOutput] = useState('')\n\n  const fetchAndSet = (newFileURI: string, addToStack: boolean) => {\n    fetchAndParse(newFileURI).then(({ parser }: { parser: any }) => {\n      addToStack && setFileStack(fileStack.concat([newFileURI]))\n      setOutput(parser.toHTML() || '')\n      onFileURIChange && onFileURIChange(newFileURI)\n    })\n  }\n\n  useEffect(() => {\n    fetchAndSet(fileURI, true)\n  }, [])\n\n  window.addEventListener(\n    'message',\n    (event) => {\n      if (event.origin !== window.location.origin) return\n\n      try {\n        const newFileURI = JSON.parse(unescape(event.data)).lmURI\n        fetchAndSet(newFileURI, true)\n      } catch (e) {}\n    },\n    false\n  )\n\n  function goBack() {\n    fetchAndSet(fileStack[fileStack.length - 2], false)\n    setFileStack(fileStack.slice(0, -1))\n  }\n\n  return (\n    <div>\n      {fileStack.length > 1 && (\n        <a onClick={goBack} style={{ cursor: 'pointer' }}>\n          ‚Üê Back\n        </a>\n      )}\n      <div className=\"LM-output\" dangerouslySetInnerHTML={{ __html: output }} />\n    </div>\n  )\n}\n\nexport const LinkedMarkdownEditor = ({ fileURI }: Props) => {\n  const [input, setInput] = useState<string>('')\n  const [output, setOutput] = useState('')\n\n  const fetchAndSet = (newFileURI: string) => {\n    fetchAndParse(newFileURI).then(\n      ({ file, parser }: { file: string; parser: any }) => {\n        setInput(file || '')\n        setOutput(parser.toHTML() || '')\n        !!file && localStorage.setItem('saved-input', file)\n      }\n    )\n  }\n\n  useEffect(() => {\n    fetchAndSet(fileURI)\n  }, [fileURI])\n\n  useEffect(() => {\n    const parser = new LinkedMarkdown(input)\n    parser.parse().then(() => {\n      setOutput(parser.toHTML())\n    })\n    input !== '' && localStorage.setItem('saved-input', input)\n  }, [input])\n\n  useEffect(() => {\n    fetchAndSet(fileURI)\n    const savedInput = localStorage.getItem('saved-input')\n    !!savedInput && setInput(savedInput || '')\n  }, [])\n\n  const handleInput = (e: React.SyntheticEvent) => {\n    const target = e.target as typeof e.target & {\n      value: string\n    }\n\n    setInput(target.value)\n  }\n\n  return (\n    <div className=\"LM-split-screen\">\n      <textarea className=\"LM-input\" onChange={handleInput} value={input} />\n      <div className=\"LM-output\" dangerouslySetInnerHTML={{ __html: output }} />\n    </div>\n  )\n}\n"],"names":["IPFS_GATEWAY","fetchAndParse","fileURI","ipfsURI","startsWith","split","fetch","data","text","file","parser","LinkedMarkdown","parse","LinkedMarkdownViewer","onFileURIChange","useState","fileStack","setFileStack","output","setOutput","fetchAndSet","newFileURI","addToStack","then","concat","toHTML","useEffect","window","addEventListener","event","origin","location","JSON","unescape","lmURI","e","goBack","length","slice","React","onClick","style","cursor","className","dangerouslySetInnerHTML","__html","LinkedMarkdownEditor","input","setInput","localStorage","setItem","savedInput","getItem","handleInput","target","value","onChange"],"mappings":"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"}