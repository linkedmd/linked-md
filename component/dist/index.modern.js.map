{"version":3,"file":"index.modern.js","sources":["../src/index.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react'\nimport { LinkedMarkdown } from '@linkedmd/parser'\nimport './styles.css'\n\nconst IPFS_GATEWAY = 'https://cf-ipfs.com/ipfs'\n\nconst fetchAndParse = async (fileURI: string) => {\n  const ipfsURI = fileURI.startsWith('ipfs://')\n    ? `${IPFS_GATEWAY}/${fileURI.split('ipfs://')[1]}`\n    : false\n  const data = await fetch(ipfsURI ? ipfsURI : fileURI)\n  const file = await data.text()\n  const parser = new LinkedMarkdown(file)\n  await parser.parse()\n  return { file, parser }\n}\n\nconst getUrlParams = (search: string) => {\n  let hashes = search.slice(search.indexOf('#') + 1).split('&')\n  return hashes.reduce((params, hash) => {\n    let [key, val] = hash.split('=')\n    return Object.assign(params, { [key]: decodeURIComponent(val) })\n  }, {})\n}\n\ntype FileURICallback = (newFileURI: string) => any\n\ninterface Props {\n  fileURI: string\n  onFileURIChange?: FileURICallback\n}\n\nexport const LinkedMarkdownViewer = ({ fileURI, onFileURIChange }: Props) => {\n  const [fileStack, setFileStack] = useState<string[]>([])\n  const [output, setOutput] = useState('')\n\n  const fetchAndSet = (newFileURI: string) => {\n    fetchAndParse(newFileURI).then(({ parser }: { parser: any }) => {\n      setFileStack(fileStack.concat([newFileURI]))\n      setOutput(parser.toHTML() || '')\n      console.log(newFileURI)\n      onFileURIChange && onFileURIChange(newFileURI)\n    })\n  }\n\n  useEffect(() => {\n    fetchAndSet(fileURI)\n  }, [])\n\n  window.addEventListener('hashchange', () => {\n    const params = getUrlParams(window.location.hash)\n    const newFileURI = params['LinkedMD-URI']\n    newFileURI && fetchAndSet(newFileURI)\n  })\n\n  return (\n    <div className=\"LM-output\" dangerouslySetInnerHTML={{ __html: output }} />\n  )\n}\n\nexport const LinkedMarkdownEditor = ({ fileURI }: Props) => {\n  const [input, setInput] = useState<string>('')\n  const [output, setOutput] = useState('')\n\n  const fetchAndSet = (newFileURI: string) => {\n    fetchAndParse(newFileURI).then(\n      ({ file, parser }: { file: string; parser: any }) => {\n        setInput(file || '')\n        setOutput(parser.toHTML() || '')\n        !!file && localStorage.setItem('saved-input', file)\n      }\n    )\n  }\n\n  useEffect(() => {\n    fetchAndSet(fileURI)\n  }, [fileURI])\n\n  useEffect(() => {\n    const parser = new LinkedMarkdown(input)\n    parser.parse().then(() => {\n      setOutput(parser.toHTML())\n    })\n    input !== '' && localStorage.setItem('saved-input', input)\n  }, [input])\n\n  useEffect(() => {\n    fetchAndSet(fileURI)\n    const savedInput = localStorage.getItem('saved-input')\n    !!savedInput && setInput(savedInput || '')\n  }, [])\n\n  const handleInput = (e: React.SyntheticEvent) => {\n    const target = e.target as typeof e.target & {\n      value: string\n    }\n\n    setInput(target.value)\n  }\n\n  return (\n    <div className=\"LM-split-screen\">\n      <textarea className=\"LM-input\" onChange={handleInput} value={input} />\n      <div className=\"LM-output\" dangerouslySetInnerHTML={{ __html: output }} />\n    </div>\n  )\n}\n"],"names":["IPFS_GATEWAY","fetchAndParse","fileURI","ipfsURI","startsWith","split","data","fetch","file","text","parser","LinkedMarkdown","parse","getUrlParams","search","hashes","slice","indexOf","reduce","params","hash","key","val","Object","assign","decodeURIComponent","LinkedMarkdownViewer","onFileURIChange","fileStack","setFileStack","useState","output","setOutput","fetchAndSet","newFileURI","then","concat","toHTML","console","log","useEffect","window","addEventListener","location","React","className","dangerouslySetInnerHTML","__html","LinkedMarkdownEditor","input","setInput","localStorage","setItem","savedInput","getItem","handleInput","e","target","value","onChange"],"mappings":"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"}